

<div class="bg-white dark:bg-gray-900 min-h-screen py-6 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md mx-auto">
    <!-- Tarjeta del formulario -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
      <!-- Encabezado -->
      <div class="text-center mb-8">
        <div class="bg-blue-100 dark:bg-blue-900/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fa-solid fa-lock text-blue-600 dark:text-blue-400 text-2xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Cambiar Contraseña</h2>
        <p class="text-gray-500 dark:text-gray-400 mt-2">Actualiza tu contraseña para mantener tu cuenta segura</p>
      </div>

      <form [formGroup]="form" (ngSubmit)="changePassword()" class="space-y-6">
        <!-- Contraseña actual -->
        <div class="space-y-2">
          <label for="currentPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Contraseña actual *
          </label>
          <div class="relative">
            <input
              formControlName="currentPassword"
              placeholder="Ingrese su contraseña actual"
              type="password"
              id="currentPassword"
              [ngClass]="{
                'border-red-500': f['currentPassword'].invalid && f['currentPassword'].touched,
                'border-green-500': f['currentPassword'].valid && f['currentPassword'].touched
              }"
              class="w-full px-4 py-2.5 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
            />
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa-solid fa-lock text-gray-400"></i>
            </div>
          </div>
          <div *ngIf="f['currentPassword'].invalid && f['currentPassword'].touched" class="text-red-500 text-sm flex items-center gap-1">
            <i class="fa-solid fa-circle-exclamation"></i>
            La contraseña actual es requerida
          </div>
        </div>

        <!-- Nueva contraseña -->
        <div class="space-y-2">
          <label for="newPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Nueva contraseña *
          </label>
          <div class="relative">
            <input
              formControlName="newPassword"
              placeholder="Ingrese su nueva contraseña"
              type="password"
              id="newPassword"
              [ngClass]="{
                'border-red-500': f['newPassword'].invalid && f['newPassword'].touched,
                'border-green-500': f['newPassword'].valid && f['newPassword'].touched
              }"
              class="w-full px-4 py-2.5 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
            />
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa-solid fa-key text-gray-400"></i>
            </div>
          </div>
          <div *ngIf="f['newPassword'].invalid && f['newPassword'].touched" class="text-red-500 text-sm">
            <div *ngIf="f['newPassword'].errors?.['required']" class="flex items-center gap-1">
              <i class="fa-solid fa-circle-exclamation"></i>
              La nueva contraseña es obligatoria
            </div>
            <div *ngIf="f['newPassword'].errors?.['minlength']" class="flex items-center gap-1 mt-1">
              <i class="fa-solid fa-circle-exclamation"></i>
              Debe tener al menos 6 caracteres
            </div>
            <div *ngIf="f['newPassword'].errors?.['maxlength']" class="flex items-center gap-1 mt-1">
              <i class="fa-solid fa-circle-exclamation"></i>
              No debe exceder los 20 caracteres
            </div>
          </div>
          
          <!-- Indicador de fortaleza de contraseña -->
          <div *ngIf="f['newPassword'].value && !f['newPassword'].errors?.['minlength']" class="mt-2">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-xs text-gray-500 dark:text-gray-400">Fortaleza:</span>
              <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
                <div class="h-1.5 rounded-full transition-all duration-300" 
                     [ngClass]="getPasswordStrengthClass()"
                     [style.width.%]="getPasswordStrength()"></div>
              </div>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400">
              {{ getPasswordStrengthText() }}
            </p>
          </div>
        </div>

        <!-- Confirmar nueva contraseña -->
        <div class="space-y-2">
          <label for="confirmPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Confirmar contraseña *
          </label>
          <div class="relative">
            <input
              formControlName="confirmPassword"
              placeholder="Confirme su nueva contraseña"
              type="password"
              id="confirmPassword"
              [ngClass]="{
                'border-red-500': f['confirmPassword'].invalid && f['confirmPassword'].touched,
                'border-green-500': f['confirmPassword'].valid && f['confirmPassword'].touched
              }"
              class="w-full px-4 py-2.5 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
            />
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa-solid fa-check-double text-gray-400"></i>
            </div>
          </div>
          <div *ngIf="f['confirmPassword'].invalid && f['confirmPassword'].touched" class="text-red-500 text-sm">
            <div *ngIf="f['confirmPassword'].errors?.['required']" class="flex items-center gap-1">
              <i class="fa-solid fa-circle-exclamation"></i>
              Debe confirmar la contraseña
            </div>
            <div *ngIf="f['confirmPassword'].errors?.['mismatch']" class="flex items-center gap-1 mt-1">
              <i class="fa-solid fa-circle-exclamation"></i>
              Las contraseñas no coinciden
            </div>
          </div>
        </div>

        <!-- Requisitos de contraseña -->
        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
          <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Requisitos de contraseña:</h4>
          <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
            <li class="flex items-center gap-2">
              <i class="fa-solid fa-check w-4 text-green-500"></i>
              Mínimo 6 caracteres
            </li>
            <li class="flex items-center gap-2">
              <i class="fa-solid fa-check w-4 text-green-500"></i>
              Máximo 20 caracteres
            </li>
            <li class="flex items-center gap-2">
              <i class="fa-solid fa-lightbulb w-4 text-blue-500"></i>
              Usa mayúsculas, números y símbolos
            </li>
          </ul>
        </div>

        <!-- Botones -->
        <div class="flex flex-col sm:flex-row gap-3 pt-4">
          <button
            type="button"
            (click)="routerBack()"
            class="flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 focus:ring-2 focus:ring-gray-500 transition-colors duration-200 dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600"
          >
            Cancelar
          </button>
          <button
            type="submit"
            [disabled]="form.invalid || isChangingPassword"
            [ngClass]="{
              'opacity-50 cursor-not-allowed': form.invalid || isChangingPassword,
              'hover:bg-blue-700': form.valid && !isChangingPassword
            }"
            class="flex-1 px-4 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg focus:ring-4 focus:ring-blue-300 transition-colors duration-200 flex items-center justify-center gap-2"
          >
            <i class="fa-solid" [ngClass]="{'fa-lock': !isChangingPassword, 'fa-spinner fa-spin': isChangingPassword}"></i>
            {{ isChangingPassword ? 'Cambiando...' : 'Cambiar contraseña' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Información de seguridad -->
    <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
      <div class="flex items-start gap-3">
        <i class="fa-solid fa-shield-alt text-blue-500 dark:text-blue-400 mt-0.5"></i>
        <div>
          <h4 class="text-sm font-medium text-blue-800 dark:text-blue-300">Seguridad de la cuenta</h4>
          <p class="text-sm text-blue-700 dark:text-blue-400 mt-1">
            Después de cambiar tu contraseña, se cerrará la sesión automáticamente por seguridad.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>