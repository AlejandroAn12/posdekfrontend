<app-header [title]="titleComponent" [subtitle]="subtitleComponent" [isUpdate]="isUpdate"></app-header>

<div class="bg-white dark:bg-gray-900 min-h-screen py-6 px-4 sm:px-6 lg:px-8">
  <div class="max-w-2xl mx-auto">
    <!-- Encabezado de sección -->
    <div class="mb-8">
      <h1 class="text-2xl font-bold text-gray-800 dark:text-white">Detalles de Credenciales</h1>
      <p class="text-gray-500 dark:text-gray-400 mt-2">Complete la información requerida para {{ isUpdate ? 'actualizar'
        : 'crear' }} las credenciales</p>
    </div>

    <!-- Formulario -->
    <form [formGroup]="form" class="space-y-6">
      <!-- Campo de empleado (solo en modo actualización) -->
      <div *ngIf="isUpdate" class="space-y-2">
        <label for="input-employee" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
          Colaborador
        </label>
        <input
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500"
          formControlName="employee" type="text" id="input-employee" placeholder="Ingrese un usuario para el empleado"
          required />
      </div>

      <!-- Select empleado (solo en modo creación) -->
      <div *ngIf="!isUpdate" class="space-y-2">
        <label for="employeeId" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
          Colaborador
        </label>
        <div class="relative">
          <select formControlName="employeeId" id="employeeId" [ngClass]="{
              'border-red-500': f['employeeId'].invalid && f['employeeId'].touched,
              'border-green-500': f['employeeId'].valid && f['employeeId'].touched
            }"
            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg appearance-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500">
            <option *ngIf="employees.length > 0" disabled selected value="">
              Seleccione un colaborador
            </option>
            <option *ngIf="employees.length < 1" disabled selected value="">
              No hay colaboradores sin credenciales
            </option>
            <option *ngFor="let emp of employees" [value]="emp.id">
              {{ emp.name }} {{ emp.surname }}
            </option>
          </select>
          <div
            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
            <i class="fa-solid fa-chevron-down text-sm"></i>
          </div>
        </div>
        <div *ngIf="f['employeeId'].invalid && f['employeeId'].touched"
          class="text-red-500 text-sm flex items-center mt-1">
          <i class="fa-solid fa-circle-exclamation mr-1"></i>
          Debe seleccionar al menos un colaborador.
        </div>
      </div>

      <!-- Select de cargo -->
      <div class="space-y-2">
        <label for="roleId" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
          Cargo
        </label>
        <div class="relative">
          <select formControlName="roleId" id="roleId" [ngClass]="{
              'border-red-500': f['roleId'].invalid && f['roleId'].touched,
              'border-green-500': f['roleId'].valid && f['roleId'].touched
            }"
            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg appearance-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500">
            <option *ngIf="roles.length > 0" disabled selected value="">
              Seleccione un cargo
            </option>
            <option *ngIf="roles.length < 1" disabled value="">
              No hay cargos disponibles
            </option>
            <option *ngFor="let role of roles" [value]="role.id">
              {{ role.name }}
            </option>
          </select>
          <div
            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
            <i class="fa-solid fa-chevron-down text-sm"></i>
          </div>
        </div>
        <div *ngIf="f['roleId'].invalid && f['roleId'].touched" class="text-red-500 text-sm flex items-center mt-1">
          <i class="fa-solid fa-circle-exclamation mr-1"></i>
          Debe seleccionar un cargo.
        </div>
      </div>

      <!-- Campos de usuario y contraseña -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Campo de usuario -->
        <div class="space-y-2">
          <label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Usuario
          </label>
          <input formControlName="username" placeholder="Nombre de usuario" type="text" id="username" [ngClass]="{
              'border-red-500': f['username'].invalid && f['username'].touched,
              'border-green-500': f['username'].valid && f['username'].touched
            }"
            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500" />
          <div *ngIf="f['username'].invalid && f['username'].touched"
            class="text-red-500 text-sm flex items-center mt-1">
            <i class="fa-solid fa-circle-exclamation mr-1"></i>
            El nombre de usuario es obligatorio.
          </div>
        </div>

        <!-- Campo de contraseña (solo en modo creación) -->
        <div *ngIf="!isUpdate" class="space-y-2">
          <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Contraseña
          </label>
          <div class="relative">
            <input formControlName="password" placeholder="Contraseña" [type]="showPassword ? 'text' : 'password'"
              id="password" [ngClass]="{
        'border-red-500': f['password'].invalid && f['password'].touched,
        'border-green-500': f['password'].valid && f['password'].touched
      }" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500" />
            <button type="button"
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
              (click)="togglePasswordVisibility()" aria-label="Toggle password visibility">
              <i class="fa-solid" [ngClass]="{'fa-eye': !showPassword, 'fa-eye-slash': showPassword}"></i>
            </button>
          </div>
          <div *ngIf="f['password'].invalid && f['password'].touched"
            class="text-red-500 text-sm flex items-center mt-1">
            <i class="fa-solid fa-circle-exclamation mr-1"></i>
            La contraseña es obligatoria.
          </div>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="flex flex-col-reverse sm:flex-row justify-end gap-3 pt-4">
        <button type="button" (click)="routeBack()"
          class="px-5 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-colors duration-200 dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600">
          Cancelar
        </button>
        <button type="submit" (click)="onSubmit()" [disabled]="form.invalid && !isUpdate" [ngClass]="{
            'opacity-70 cursor-not-allowed': form.invalid && !isUpdate,
            'hover:bg-blue-700 cursor-pointer': !form.invalid || isUpdate
          }"
          class="px-5 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg focus:ring-4 focus:ring-blue-300 focus:outline-none transition-colors duration-200">
          <span *ngIf="isUpdate; else saveText">
            <i class="fa-solid fa-rotate mr-1"></i> Actualizar
          </span>
          <ng-template #saveText>
            <i class="fa-solid fa-floppy-disk mr-1"></i> Guardar
          </ng-template>
        </button>
      </div>
    </form>
  </div>
</div>