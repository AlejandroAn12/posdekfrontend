<app-header [title]="titleComponent" [subtitle]="subtitleComponent" [isUpdate]="isUpdate"></app-header>

<div class="bg-white dark:bg-gray-900 min-h-screen py-6 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">
    <!-- Encabezado de sección -->
    <div class="mb-8">
      <h1 class="text-2xl font-bold text-gray-800 dark:text-white">Detalles del Producto</h1>
      <p class="text-gray-500 dark:text-gray-400 mt-2">Complete la información requerida para {{ isUpdate ? 'actualizar'
        : 'registrar' }} el producto</p>
    </div>

    <!-- Formulario -->
    <form [formGroup]="form" class="space-y-6 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm">
      <!-- Fila: Proveedor y Categoría -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Proveedor -->
        <div class="space-y-2">
          <label for="supplierId" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Proveedor *
          </label>
          <div class="relative">
            <select formControlName="supplierId" id="supplierId" [ngClass]="{
                'border-red-500': f['supplierId'].invalid && f['supplierId'].touched,
                'border-green-500': f['supplierId'].valid && f['supplierId'].touched
              }"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg appearance-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500">
              <option value="" disabled selected>Selecciona el proveedor</option>
              <option *ngFor="let supplier of suppliers" [value]="supplier.id">
                {{ supplier.company_name }}
              </option>
            </select>
            <div
              class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
              <i class="fa-solid fa-chevron-down text-sm"></i>
            </div>
          </div>
        </div>

        <!-- Categoría -->
        <div class="space-y-2">
          <label for="categoryId" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Categoría *
          </label>
          <div class="relative">
            <select formControlName="categoryId" id="categoryId" [ngClass]="{
                'border-red-500': f['categoryId'].invalid && f['categoryId'].touched,
                'border-green-500': f['categoryId'].valid && f['categoryId'].touched
              }"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg appearance-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500">
              <option value="" disabled selected>Selecciona la categoría</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
            <div
              class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
              <i class="fa-solid fa-chevron-down text-sm"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Código Interno (solo en actualización) -->
      <div *ngIf="isUpdate" class="space-y-2">
        <label for="code" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
          Código Interno
        </label>
        <input formControlName="code" [disabled]="isEditing" type="text" id="code"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-gray-100 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300 cursor-not-allowed" />
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">El código interno no puede ser modificado</p>
      </div>

      <!-- Código de Barras -->
      <div class="space-y-2">
        <label for="barcode" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
          <i class="fa-solid fa-barcode mr-2"></i>Código de Barras *
        </label>
        <input formControlName="barcode" placeholder="Escanee o ingrese el código de barras" type="text" id="barcode"
          [ngClass]="{
            'border-red-500': f['barcode'].invalid && f['barcode'].touched,
            'border-green-500': f['barcode'].valid && f['barcode'].touched
          }"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500" />
        <div *ngIf="f['barcode'].invalid && f['barcode'].touched" class="text-red-500 text-sm flex items-center mt-1">
          <i class="fa-solid fa-circle-exclamation mr-1"></i>
          El código de barras es obligatorio y debe tener 13 dígitos.
        </div>
      </div>

      <!-- Nombre del Producto -->
      <div class="space-y-2">
        <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
          Nombre del Producto *
        </label>
        <input formControlName="name" placeholder="Ingrese el nombre del producto o servicio" type="text" id="name"
          [ngClass]="{
            'border-red-500': f['name'].invalid && f['name'].touched,
            'border-green-500': f['name'].valid && f['name'].touched
          }"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500" />
        <div *ngIf="f['name'].invalid && f['name'].touched" class="text-red-500 text-sm flex items-center mt-1">
          <i class="fa-solid fa-circle-exclamation mr-1"></i>
          El nombre del producto es obligatorio.
        </div>
      </div>

      <!-- Fila: Unidad de Medida y Stock -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Unidad de Medida -->
        <div class="space-y-2">
          <label for="unitOfMeasurementId" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Unidad de Medida *
          </label>
          <div class="relative">
            <select formControlName="unitOfMeasurementId" id="unitOfMeasurementId" [ngClass]="{
                'border-red-500': f['unitOfMeasurementId'].invalid && f['unitOfMeasurementId'].touched,
                'border-green-500': f['unitOfMeasurementId'].valid && f['unitOfMeasurementId'].touched
              }"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg appearance-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500">
              <option value="" disabled selected>Selecciona la unidad de medida</option>
              <option *ngFor="let unit of unitsOfMeasurement" [value]="unit.id">
                {{ unit.name }}
              </option>
            </select>
            <div
              class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
              <i class="fa-solid fa-chevron-down text-sm"></i>
            </div>
          </div>
        </div>

        <!-- Stock -->
        <div class="space-y-2">
          <label for="addStock" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Stock Inicial
          </label>
          <input formControlName="addStock" type="number" min="0" id="addStock"
            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500" />
        </div>
      </div>

      <!-- Fila: Precios -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Precio de Compra -->
        <div class="space-y-2">
          <label for="purchasePrice" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Precio de Compra
            <span class="text-xs text-gray-500">(Proveedor)</span>
          </label>
          <div class="relative">
            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
            <input formControlName="purchasePrice" type="number" min="0" step="0.01" id="purchasePrice"
              placeholder="0.00"
              class="w-full pl-8 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500" />
          </div>
        </div>

        <!-- Precio de Venta -->
        <div class="space-y-2">
          <label for="salePrice" class="text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center">
            Precio de Venta
            <span class="text-xs text-gray-500 ml-1">(Público)</span>
            <div class="relative group ml-2">
              <i class="fa-solid fa-circle-info text-blue-500 cursor-help"></i>
              <div
                class="absolute left-1/2 transform -translate-x-1/2 bottom-full mb-2 w-64 bg-gray-900 text-white text-xs p-3 rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 shadow-xl z-10">
                Recuerde tener en cuenta que si el precio de venta del producto ya incluye el I.V.A. debe ingresar el
                valor total de venta calculado con el I.V.A (P.V.P * 15/100).
              </div>
            </div>
          </label>
          <div class="relative">
            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
            <input formControlName="salePrice" type="number" min="0" step="0.01" id="salePrice" placeholder="0.00"
              class="w-full pl-8 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500" />
          </div>
        </div>
      </div>

      <!-- Descripción -->
      <div class="space-y-2">
        <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
          Descripción
        </label>
        <textarea formControlName="description" placeholder="Ingrese una descripción breve del producto o servicio"
          rows="3" id="description"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500 resize-none"></textarea>
      </div>

      <!-- Botones de Acción -->
      <div
        class="flex flex-col-reverse sm:flex-row justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700">
        <button type="button" (click)="btnBack()"
          class="px-5 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-colors duration-200 dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600">
          Cancelar
        </button>
        <button type="submit" (click)="saveProduct()" [disabled]="form.invalid" [ngClass]="{
            'opacity-70 cursor-not-allowed': form.invalid,
            'hover:bg-blue-700 cursor-pointer': form.valid
          }"
          class="px-5 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg focus:ring-4 focus:ring-blue-300 focus:outline-none transition-colors duration-200 flex items-center gap-2">
          <i class="fa-solid fa-floppy-disk"></i>
          {{ isUpdate ? "Guardar cambios" : "Guardar producto" }}
        </button>
      </div>
    </form>
  </div>
</div>